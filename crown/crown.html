<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Document</title>
</head>
<body style="margin-top: 30px">
<div class="container" id="crown">
    <div class="row row-cols-3">
        <div class="col">
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="floatingInput" placeholder="UserId">
                <label for="floatingInput">UserId</label>
            </div>
            <div class="form-floating" style="margin-bottom: 20px">
                <input type="password" class="form-control" id="floatingPassword" placeholder="ToUserId">
                <label for="floatingPassword">ToUserId</label>
            </div>
            <div>
                <bullshit-form
                        v-for="(n, i) in items"
                        v-model="n.data"
                        v-bind:items="items"
                        :key="n.id"
                        @del="items.splice(i, 1)"
                ></bullshit-form>
            </div>
            <div class="d-grid gap-2">
                <button @click="addItem" class="btn btn-primary" type="button">Добавить ещё товар</button>
            </div>
        </div>
    </div>
</div>
<script>

    Vue.component('bullshit-form', {
        data: function () {
            return {
                postItems: [],
                text: ''
            }
        },
        template: `<div class="form">
    <div v-for="(v, k) in formData" v-bind:key="k" style="margin: 20px 0;">
    <label for="exampleDataList" class="form-label">Кронные товары</label>
      <div style="display: flex">
        <input v-model="text" class="form-control" list="datalistOptions" id="exampleDataList" placeholder="Искать...">
        <datalist id="datalistOptions">
        <option v-for="postItem in postItems" v-bind:value="postItem.nameRU" v-bind:key="postItem.key"/>
        </datalist>
        <button type="button" class="btn btn-primary" @click="$emit('del')">X</button>
     </div>
  </div>
</div>`,
        props: ['value', 'items'],
        computed: {
            formData() {
                return new Proxy(this.value, {
                    set: (target, prop, val) => {
                        this.$emit('input', {...target, [prop]: val});
                        return true;
                    },
                });
            },
        },
        created() {
            axios.get('https://bot.teso.world/crown/item/').then((response) => {
                this.postItems = response.data;
            });
        },
        watch: {
            text: function () {
                if (this.text !== '') {
                    console.log(this.text)
                }
            }
        },
    });

    const vue = new Vue({
        el: '#crown',
        data: {
            items: [],
            postItems: [],
            text: '',
        },
        methods: {
            addItem() {
                this.items.push({
                    id: 1 + Math.max(0, ...this.items.map(n => n.id)),
                    data: {
                        xxx: ''
                    },
                });
            },
        },
        created() {
            axios.get('https://bot.teso.world/crown/item/').then((response) => {
                this.postItems = response.data;
            });
            this.addItem();
        },
    });
</script>
</body>
</html>
